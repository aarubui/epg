import{f as R,r,o as c,c as f,w as i,a as l,b as T,v as B,d as _,e as b,F as m,g as P,t as I,h as O,i as w,j as z,$ as F,k as Y,p as A,l as E,m as j,n as q,q as U,s as V,u as Z,x as G,y as J,z as K}from"./vendor.0cc6f913.js";const Q=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}};Q();var L=(a,e)=>{const t=a.__vccOpts||a;for(const[s,n]of e)t[s]=n;return t};const W={data:function(){return{hideChannels:!1,query:null,searchId:null}},computed:{searchResults(){let a=[];return this.$root.guides.forEach(e=>{a=[...a,...e.search(this.query,this.$root.now)]}),a.sort((e,t)=>e.start-t.start)}},methods:{search(a,e){window.clearTimeout(this.searchId),this.searchId=window.setTimeout(()=>{this.$nextTick(()=>this.query=e)},500)},addSearchHistory(a){this.$root.history.log(a.target.value)}},mounted(){R.autocomplete.create({openIn:"dropdown",inputEl:'input[type="search"]',source:(a,e)=>this.$root.history.suggest(a,e)})}},X=O("EPG"),ee={class:"item-time"},te={class:"item-prog"};function ne(a,e,t,s,n,o){const h=r("f7-link"),p=r("f7-nav-left"),g=r("f7-nav-title"),k=r("f7-nav-right"),v=r("f7-searchbar"),$=r("f7-subnavbar"),d=r("f7-navbar"),y=r("f7-list-item"),C=r("f7-list"),x=r("f7-page");return c(),f(x,{name:"home"},{default:i(()=>[l(d,{sliding:!1},{default:i(()=>[l(p,null,{default:i(()=>[l(h,{"icon-ios":"f7:menu","icon-aurora":"f7:menu","icon-md":"material:menu","panel-open":"left"})]),_:1}),l(g,{sliding:""},{default:i(()=>[X]),_:1}),l(k,null,{default:i(()=>[l(h,{"icon-ios":"f7:star_fill","icon-aurora":"f7:star_fill","icon-md":"material:star_fill",href:"/favorites"})]),_:1}),l($,{inner:!1},{default:i(()=>[l(v,{"custom-search":"","search-container":".search-list","onSearchbar:enable":e[0]||(e[0]=u=>a.hideChannels=!0),"onSearchbar:disable":e[1]||(e[1]=u=>a.hideChannels=!1),"onSearchbar:search":o.search,onBlur:o.addSearchHistory},null,8,["onSearchbar:search","onBlur"])]),_:1})]),_:1}),T(l(C,{"media-list":""},{default:i(()=>[(c(!0),_(m,null,b(a.$root.guides,u=>(c(),_(m,null,[(c(!0),_(m,null,b(u.enabledChannels,S=>(c(),f(y,{title:S.name,media:S.icon,link:`/channel/${S.id}`},{text:i(()=>[(c(!0),_(m,null,b(S.nextProgs(a.$root.now),D=>(c(),_("div",null,[P("span",ee,I(D.startString),1),P("span",te,I(D.titleSubtitle),1)]))),256))]),_:2},1032,["title","media","link"]))),256))],64))),256))]),_:1},512),[[B,!a.hideChannels]]),T(l(C,{class:"search-list searchbar-found","media-list":""},{default:i(()=>[(c(!0),_(m,null,b(o.searchResults,u=>(c(),f(y,{media:u.channel.icon,header:`${u.channel.name} - ${u.date}`,title:u.title,subtitle:u.subtitle,text:u.desc,link:u.channelLink},null,8,["media","header","title","subtitle","text","link"]))),256))]),_:1},512),[[B,a.hideChannels]])]),_:1})}var se=L(W,[["render",ne]]);const ae={props:{id:String,day:{type:String,default:"0"}},data(){return{selectedTab:parseInt(this.day),tabs:[0,1,2,3,4,5,6]}},computed:{channel(){for(let a=0;a<this.$root.guides.length;a++){const e=this.$root.guides[a];for(let t=0;t<e.channels.length;t++){const s=e.channels[t];if(s.id===this.id)return s}}}},methods:{tabText(a){return w().add(a,"days").format("ddd")}}};function oe(a,e,t,s,n,o){const h=r("f7-navbar"),p=r("f7-link"),g=r("f7-toolbar"),k=r("f7-list-item"),v=r("f7-list"),$=r("f7-page");return c(),f($,null,{default:i(()=>[l(h,{title:o.channel.name,"back-link":"Back"},null,8,["title"]),l(g,{tabbar:"",scrollable:"",position:"bottom"},{default:i(()=>[(c(!0),_(m,null,b(n.tabs,(d,y)=>(c(),f(p,{key:d,onClick:C=>n.selectedTab=y,"tab-link-active":y===n.selectedTab,text:o.tabText(y)},null,8,["onClick","tab-link-active","text"]))),128))]),_:1}),l(v,{"media-list":""},{default:i(()=>[(c(!0),_(m,null,b(o.channel.dayProgs(n.selectedTab),d=>(c(),f(k,{media:d.icon,header:d.startString,title:d.title,subtitle:d.subtitle,text:d.desc},null,8,["media","header","title","subtitle","text"]))),256))]),_:1})]),_:1})}var re=L(ae,[["render",oe]]);const le={computed:{searchResults(){let a=[];const e=this.$root.history.toExpr();return e&&this.$root.guides.forEach(t=>{a=[...a,...t.favorites(e,this.$root.now)]}),a.sort((t,s)=>t.start-s.start)}}};function ie(a,e,t,s,n,o){const h=r("f7-link"),p=r("f7-nav-right"),g=r("f7-navbar"),k=r("f7-list-item"),v=r("f7-list"),$=r("f7-page");return c(),f($,{name:"home"},{default:i(()=>[l(g,{title:"Favorites","back-link":"Back"},{default:i(()=>[l(p,null,{default:i(()=>[l(h,{"icon-ios":"f7:pencil","icon-aurora":"f7:pencil","icon-md":"material:edit","panel-open":"right"})]),_:1})]),_:1}),l(v,{"media-list":""},{default:i(()=>[(c(!0),_(m,null,b(o.searchResults,d=>(c(),f(k,{media:d.channel.icon,header:`${d.channel.name} - ${d.date}`,title:d.title,subtitle:d.subtitle,text:d.desc,link:d.channelLink},null,8,["media","header","title","subtitle","text","link"]))),256))]),_:1})]),_:1})}var ce=L(le,[["render",ie]]);const ue={},de=P("p",null,"Sorry",-1),he=P("p",null,"Requested content not found.",-1);function fe(a,e,t,s,n,o){const h=r("f7-navbar"),p=r("f7-block"),g=r("f7-page");return c(),f(g,null,{default:i(()=>[l(h,{title:"Not found","back-link":"Back"}),l(p,{strong:""},{default:i(()=>[de,he]),_:1})]),_:1})}var _e=L(ue,[["render",fe]]),pe=[{path:"/",component:se},{path:"/channel/:id/:day?",component:re},{path:"/favorites",component:ce},{path:"(.*)",component:_e}];class M{localize(e){if(e.length<=1)return e.text();const t=[...window.navigator.languages,"en"];for(let s=0;s<t.length;s++){const n=t[s].substr(0,2),o=e.filter("[lang^="+n+"]");if(o.length)return o.first().text()}return e.eq(0).text()}}w.extend(z);class me extends M{constructor(e,t){super();this.elem=e,this.channel=t}get elemDom(){return F(this.elem)}get title(){return this.localize(this.elemDom.find("title"))}get subtitle(){return this.localize(this.elemDom.find("sub-title"))}get icon(){return this.elemDom.find("icon:first").attr("src")}get desc(){return this.localize(this.elemDom.find("desc"))}get start(){return w(this.elemDom.attr("start"),"YYYYMMDDHHmmss ZZ")}get stop(){return w(this.elemDom.attr("stop"),"YYYYMMDDHHmmss ZZ")}get startString(){return this.start.format("HH:mm")}get date(){const e=this.start.format("ddd D MMM HH:mm"),t=this.stop.format("HH:mm");return`${e}\u2013${t}`}get titleSubtitle(){return this.subtitle?`${this.title}: ${this.subtitle}`:this.title}get channelLink(){const e=this.start.diff(w().startOf("day"),"day");return`/channel/${this.channel.id}/${e}`}}w.extend(z);class ge extends M{constructor(e,t){super();this.xml=e,this._enabled=null,this.id=t.attr("id"),this.name=this.localize(t.find("display-name")),this.icon=t.find("icon").attr("src"),this.progs=this.getProgs()}get enabled(){var e;if(this._enabled===null&&window.localStorage){const t=window.localStorage.getItem(`enabled_${this.id}`);this._enabled=t!=="0"}return(e=this._enabled)!=null?e:!0}set enabled(e){this._enabled=e,window.localStorage&&window.localStorage.setItem(`enabled_${this.id}`,e?"1":"0")}getProgs(){return this.xml.find(`programme[channel="${this.id}"]`).map((e,t)=>new me(t,this)).sort((e,t)=>e.start.unix()-t.start.unix())}nextProgs(e){const t=[];for(let s=0;s<this.progs.length&&t.length<3;s++){const n=this.progs[s];n.stop.isAfter(e)&&t.push(n)}return t}dayProgs(e){const t=w().startOf("day").add(e,"day"),s=t.add(1,"day");return this.progs.filter((n,o)=>(o.start.isSame(t)||o.start.isAfter(t))&&o.start.isBefore(s))}search(e,t){return this.progs.filter((s,n)=>n.title.toLowerCase().indexOf(e.toLowerCase())>=0&&n.stop.isAfter(t))}searchRegex(e,t){return this.progs.filter((s,n)=>n.title.toLowerCase().match(e)&&n.stop.isAfter(t))}}class H{constructor(e){this.url=e,this._enabled=null,this.loaded=!1,this.loading=!1}get enabled(){var e;if(this._enabled===null&&window.localStorage){const t=window.localStorage.getItem(`enabled_${this.name}`);this._enabled=t==="1"}return(e=this._enabled)!=null?e:!1}set enabled(e){this._enabled=e,window.localStorage&&window.localStorage.setItem(`enabled_${this.name}`,e?"1":"0")}get name(){const e=this.url.split("/");return e[e.length-1]}get channels(){if(!this.enabled||this.loading)return[];if(this.loaded)return this._channels;this.loading=!0,Y.get(this.url,{responseType:"arraybuffer"}).then(e=>{const t=A.ungzip(e.data,{to:"string"}),s=F(t);this._channels=s.find("channel").map((n,o)=>new ge(s,F(o))).get(),this.loading=!1,this.loaded=!0})}get enabledChannels(){return this.channels.filter(e=>e.enabled)}search(e,t){let s=[];return e&&e.length>=2&&this.enabledChannels.forEach(n=>{s=[...s,...n.search(e,t)]}),s}favorites(e,t){let s=[];return this.enabledChannels.forEach(n=>{s=[...s,...n.searchRegex(e,t)]}),s}}class be{constructor(e){this.key=e,this._values=null}get values(){if(this._values===null&&window.localStorage){const e=window.localStorage.getItem(`history_${this.key}`);this._values=JSON.parse(e!=null?e:"[]")}return this._values||[]}set values(e){e=E.uniq(e),E.remove(e,t=>t==null),this._values=e,window.localStorage&&window.localStorage.setItem(`history_${this.key}`,JSON.stringify(e))}log(e){e.length>0&&(this.values=E.uniq([e,...this.values]))}delete(e){let t=this.values;delete t[e],this.values=t}suggest(e,t){const s=[];this.values.forEach(n=>{n&&s.indexOf(n)<0&&e!==n&&(e.length===0||n.toLowerCase().indexOf(e.toLowerCase())>=0)&&s.push(n)}),t(s)}toExpr(){const e=[];if(this.values.forEach(t=>{t&&e.push(j(t.toLowerCase()))}),!!e.length)return new RegExp(E.uniq(e).join("|"))}}const ve={setup(){const a={name:"EPG",theme:"auto",routes:pe};return q(()=>{U(()=>{})}),{f7params:a}},mounted(){this.tick()},data(){return{now:w(),guides:[new H("https://aarubui.github.io/epg/ukepg.xml.gz"),new H("https://aarubui.github.io/epg/epg.xml.gz"),new H("https://aarubui.github.io/epg/jpepg.xml.gz")],history:new be("search"),favorites:[]}},methods:{tick(){this.$nextTick(()=>this.now=w()),window.setTimeout(this.tick,6e4)},loadFavorites(){this.favorites=[...this.history.values]},saveFavorites(){this.history.values=this.favorites}}},we=O("Delete");function ke(a,e,t,s,n,o){const h=r("f7-navbar"),p=r("f7-list-item"),g=r("f7-list"),k=r("f7-page"),v=r("f7-view"),$=r("f7-panel"),d=r("f7-swipeout-button"),y=r("f7-swipeout-actions"),C=r("f7-app");return c(),f(C,V(s.f7params,{"theme-dark":""}),{default:i(()=>[l($,{left:"",cover:"","theme-dark":""},{default:i(()=>[l(v,null,{default:i(()=>[l(k,null,{default:i(()=>[l(h,{title:"Settings"}),l(g,null,{default:i(()=>[(c(!0),_(m,null,b(n.guides,x=>(c(),f(p,{checkbox:"",title:x.name,checked:x.enabled,"onUpdate:checked":u=>x.enabled=u},{root:i(()=>[P("ul",null,[(c(!0),_(m,null,b(x.channels,u=>(c(),f(p,{checkbox:"",title:u.name,checked:u.enabled,"onUpdate:checked":S=>u.enabled=S},null,8,["title","checked","onUpdate:checked"]))),256))])]),_:2},1032,["title","checked","onUpdate:checked"]))),256))]),_:1})]),_:1})]),_:1})]),_:1}),l($,{right:"",cover:"","theme-dark":"","onPanel:open":o.loadFavorites,"onPanel:close":o.saveFavorites},{default:i(()=>[l(v,null,{default:i(()=>[l(k,null,{default:i(()=>[l(h,{title:"Favorites"}),l(g,null,{default:i(()=>[(c(!0),_(m,null,b(n.favorites,(x,u)=>(c(),f(p,{swipeout:"",key:u,title:x,"onSwipeout:deleted":S=>delete n.favorites[u]},{default:i(()=>[l(y,{right:""},{default:i(()=>[l(d,{delete:""},{default:i(()=>[we]),_:1})]),_:1})]),_:2},1032,["title","onSwipeout:deleted"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["onPanel:open","onPanel:close"]),l(v,{main:"",class:"safe-areas",url:"/"})]),_:1},16)}var $e=L(ve,[["render",ke]]);Z.use(G);const N=J($e);K(N);N.mount("#app");
